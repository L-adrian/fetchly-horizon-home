<section class="fetchly-stl" aria-label="Shop the look">
  <div class="fetchly-stl__inner">
    <div class="fetchly-stl__media">
      <div class="fetchly-stl__image">
        {% if section.settings.image %}
          <img
            src="{{ section.settings.image | image_url: width: 1600 }}"
            alt=""
            loading="lazy"
          >
        {% else %}
          <div class="fetchly-stl__ph"></div>
        {% endif %}

        <div class="fetchly-stl__hotspots" data-stl-hotspots>
          {% for block in section.blocks %}
            <button
              type="button"
              class="fetchly-stl__hotspot {% if forloop.first %}is-active{% endif %}"
              style="left: {{ block.settings.x }}%; top: {{ block.settings.y }}%;"
              data-stl-hotspot
              data-stl-index="{{ forloop.index0 }}"
              aria-label="{{ block.settings.title | escape }}"
              {{ block.shopify_attributes }}
            >
              <span class="fetchly-stl__hotspot-ring"></span>
              <span class="fetchly-stl__hotspot-plus">+</span>
            </button>
          {% endfor %}
        </div>
      </div>
    </div>

    <div class="fetchly-stl__panel">
      <div class="fetchly-stl__panel-top">
        <div class="fetchly-stl__heading">
          <h2 class="fetchly-stl__product-title" data-stl-title></h2>
          <div class="fetchly-stl__price" data-stl-price></div>
        </div>

        <div class="fetchly-stl__rating" data-stl-rating></div>
      </div>

    <div class="fetchly-stl__gallery">
    <div class="fetchly-stl__gallery-main"></div>
    <div class="fetchly-stl__gallery-thumbs">
        <div class="fetchly-stl__thumb"></div>
        <div class="fetchly-stl__thumb"></div>
        <div class="fetchly-stl__thumb"></div>
        <div class="fetchly-stl__thumb"></div>
        <div class="fetchly-stl__thumb"></div>
    </div>
    </div>

      <div class="fetchly-stl__controls">
        <div class="fetchly-stl__field">
          <div class="fetchly-stl__label">Color</div>
          <div class="fetchly-stl__swatches" data-stl-colors></div>
        </div>

        <div class="fetchly-stl__sizes" data-stl-sizes></div>
      </div>

      <div class="fetchly-stl__accordion">
        <details class="fetchly-stl__details" open>
          <summary class="fetchly-stl__summary">
            <span>Details</span>
            <span class="fetchly-stl__chev" aria-hidden="true">
              <svg viewBox="0 0 16 16" width="16" height="16" focusable="false">
                <path d="M4.2 6.3a1 1 0 0 1 1.4 0L8 8.7l2.4-2.4a1 1 0 1 1 1.4 1.4l-3.1 3.1a1 1 0 0 1-1.4 0L4.2 7.7a1 1 0 0 1 0-1.4z" fill="currentColor"></path>
              </svg>
            </span>
          </summary>
          <div class="fetchly-stl__body rte" data-stl-details></div>
        </details>

        <details class="fetchly-stl__details">
          <summary class="fetchly-stl__summary">
            <span>Size charts</span>
            <span class="fetchly-stl__chev" aria-hidden="true">
              <svg viewBox="0 0 16 16" width="16" height="16" focusable="false">
                <path d="M4.2 6.3a1 1 0 0 1 1.4 0L8 8.7l2.4-2.4a1 1 0 1 1 1.4 1.4l-3.1 3.1a1 1 0 0 1-1.4 0L4.2 7.7a1 1 0 0 1 0-1.4z" fill="currentColor"></path>
              </svg>
            </span>
          </summary>
          <div class="fetchly-stl__body rte">{{ section.settings.size_chart_text }}</div>
        </details>

        <details class="fetchly-stl__details">
          <summary class="fetchly-stl__summary">
            <span>Model information</span>
            <span class="fetchly-stl__chev" aria-hidden="true">
              <svg viewBox="0 0 16 16" width="16" height="16" focusable="false">
                <path d="M4.2 6.3a1 1 0 0 1 1.4 0L8 8.7l2.4-2.4a1 1 0 1 1 1.4 1.4l-3.1 3.1a1 1 0 0 1-1.4 0L4.2 7.7a1 1 0 0 1 0-1.4z" fill="currentColor"></path>
              </svg>
            </span>
          </summary>
          <div class="fetchly-stl__body rte">{{ section.settings.model_info_text }}</div>
        </details>
      </div>

      <div class="fetchly-stl__cta">
        <button type="button" class="fetchly-stl__add" data-stl-add>
          <span data-stl-add-text>Add To Cart</span>
        </button>
        {% if section.settings.subtext != blank %}
          <div class="fetchly-stl__sub">{{ section.settings.subtext }}</div>
        {% endif %}
      </div>

      <script type="application/json" data-stl-data>
        [
          {% for block in section.blocks %}
            {
              "title": {{ block.settings.title | json }},
              "price": {{ block.settings.price | json }},
              "ratingText": {{ block.settings.rating_text | json }},
              "colors": {{ block.settings.colors | json }},
              "sizes": {{ block.settings.sizes | json }},
              "detailsHtml": {{ block.settings.details | json }}
            }{% unless forloop.last %},{% endunless %}
          {% endfor %}
        ]
      </script>
    </div>

  </div>
</section>

<style>
.fetchly-stl__gallery{
  display: none;
}
.fetchly-stl{
  background: {{ section.settings.bg | default: "#6b2b22" }};
  color: {{ section.settings.fg | default: "#f6f0ea" }};
  padding: 90px 0;
}

.fetchly-stl__inner{
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 34px;
  display: grid;
  grid-template-columns: 1.15fr 1fr;
  gap: 60px;
  align-items: start;
}

.fetchly-stl__image{
  position: relative;
  border-radius: 18px;
  overflow: hidden;
  background: rgba(255,255,255,.06);
  min-height: 520px;
}

.fetchly-stl__image img{
  width: 100%;
  height: 100%;
  min-height: 520px;
  object-fit: cover;
  display: block;
}

.fetchly-stl__ph{
  height: 520px;
  background: rgba(255,255,255,.08);
}

.fetchly-stl__hotspots{
  position: absolute;
  inset: 0;
}

.fetchly-stl__hotspot{
  position: absolute;
  width: 44px;
  height: 44px;
  border: 0;
  background: transparent;
  cursor: pointer;
  transform: translate(-50%, -50%);
}

.fetchly-stl__hotspot-ring{
  position: absolute;
  inset: 0;
  border-radius: 999px;
  background: rgba(255,255,255,.78);
  box-shadow: 0 10px 22px rgba(0,0,0,.18);
}

.fetchly-stl__hotspot-plus{
  position: absolute;
  inset: 0;
  display: grid;
  place-items: center;
  color: #3a0b0b;
  font-size: 18px;
  font-weight: 700;
}

.fetchly-stl__hotspot.is-active .fetchly-stl__hotspot-ring{
  background: rgba(255,255,255,.92);
  outline: 2px solid rgba(255,255,255,.55);
  outline-offset: 3px;
}

.fetchly-stl__panel{
  padding-top: 6px;
}

.fetchly-stl__panel-top{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap: 18px;
}

.fetchly-stl__product-title{
  margin: 0 0 10px;
  font-size: 56px;
  line-height: 1.02;
  font-weight: 600;
}

.fetchly-stl__price{
  font-size: 34px;
  opacity: .95;
}

.fetchly-stl__rating{
  margin-top: 18px;
  font-size: 13px;
  opacity: .85;
  white-space: nowrap;
}

.fetchly-stl__controls{
  margin-top: 28px;
}

.fetchly-stl__field{
  margin-bottom: 18px;
}

.fetchly-stl__label{
  font-size: 13px;
  opacity: .85;
  margin-bottom: 10px;
}

.fetchly-stl__swatches{
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

.fetchly-stl__swatch{
  width: 16px;
  height: 16px;
  border-radius: 999px;
  border: 1px solid rgba(246,240,234,.55);
  background: rgba(246,240,234,.25);
  cursor: pointer;
}

.fetchly-stl__swatch.is-active{
  outline: 2px solid rgba(246,240,234,.75);
  outline-offset: 3px;
}

.fetchly-stl__sizes{
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-top: 10px;
}

.fetchly-stl__size{
  width: 44px;
  height: 44px;
  border-radius: 999px;
  border: 1px solid rgba(246,240,234,.55);
  background: transparent;
  color: inherit;
  font-size: 13px;
  cursor: pointer;
}

.fetchly-stl__size.is-active{
  background: rgba(246,240,234,.14);
  border-color: rgba(246,240,234,.75);
}

.fetchly-stl__accordion{
  margin-top: 18px;
  border-top: 1px solid rgba(246,240,234,.35);
}

.fetchly-stl__details{
  border-bottom: 1px solid rgba(246,240,234,.35);
}

.fetchly-stl__summary{
  list-style: none;
  cursor: pointer;
  padding: 18px 0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size: 14px;
  opacity: .92;
}

.fetchly-stl__summary::-webkit-details-marker{ display:none; }

.fetchly-stl__chev{
  display:inline-flex;
  transition: transform .25s ease;
  opacity: .9;
}

.fetchly-stl__details[open] .fetchly-stl__chev{
  transform: rotate(180deg);
}

.fetchly-stl__body{
  padding: 0 0 18px;
  font-size: 13px;
  line-height: 1.7;
  opacity: .92;
}

.fetchly-stl .rte p{ margin: 0 0 12px; }
.fetchly-stl .rte p:last-child{ margin-bottom: 0; }

.fetchly-stl__cta{
  margin-top: 26px;
}

.fetchly-stl__add{
  width: 100%;
  border: 0;
  border-radius: 999px;
  background: rgba(246,240,234,.92);
  color: #3a0b0b;
  height: 54px;
  font-size: 14px;
  cursor: pointer;
}

.fetchly-stl__add:hover{ opacity: .96; }

.fetchly-stl__sub{
  margin-top: 10px;
  text-align: center;
  font-size: 12px;
  opacity: .85;
}

.fetchly-stl__mockcart{
  margin-top: 10px;
  text-align: center;
  font-size: 12px;
  opacity: .8;
}

.fetchly-stl__gallery{
  margin-top: 18px;
}

.fetchly-stl__gallery-main{
  width:100%;
  aspect-ratio: 1 / 1;
  border-radius:18px;
  background: rgba(255,255,255,.18);
  border: 1px solid rgba(246,240,234,.25);
}

.fetchly-stl__gallery-thumbs{
  display:flex;
  gap:10px;
  margin-top:14px;
  width:100%;
}

.fetchly-stl__thumb{
  flex: 1 1 0;
  aspect-ratio: 1 / 1;
  height: auto;
  border-radius:10px;
  background: rgba(255,255,255,.18);
  border: 1px solid rgba(246,240,234,.25);
}

@media (max-width: 900px){
    .fetchly-stl__gallery{
        display: block;
    }
  .fetchly-stl{
    padding:0;
  }

  .fetchly-stl__inner{
    grid-template-columns:1fr;
    gap:0;
    padding:0;
    max-width:none;
  }

  .fetchly-stl__image{
    height: auto;
    min-height: 0;
    border-radius: 0;
  }

  .fetchly-stl__image img,
  .fetchly-stl__ph{
    min-height:520px;
 
  }

  .fetchly-stl__panel{
    padding: 28px 22px 34px;
  }

  .fetchly-stl__panel-top{
    align-items:flex-end;
  }

  .fetchly-stl__product-title{
    font-size:44px;
    margin:0 0 10px;
  }

  .fetchly-stl__price{
    font-size:28px;
  }

  .fetchly-stl__rating{
    margin-top: 0;
    font-size: 12px;
    opacity:.85;
  }

  .fetchly-stl__controls{
    margin-top: 20px;
  }

  .fetchly-stl__summary{
    padding: 18px 0;
  }

  .fetchly-stl__cta{
    margin-top: 22px;
  }

  .fetchly-stl__add{
    height: 56px;
    font-size: 14px;
  }
}

@media (max-width: 560px){
  .fetchly-stl__image{
    min-height: 520px;
  }

  .fetchly-stl__image img,
  .fetchly-stl__ph{
    height:520px;
    min-height:520px;
  }

  .fetchly-stl__thumb{
    width:52px;
    height:52px;
  }
}

</style>

<script>
(() => {
  const initSTL = (root) => {
    if (!root || root.dataset.stlInit === '1') return;
    root.dataset.stlInit = '1';

    const dataEl = root.querySelector('[data-stl-data]');
    let items = [];
    try {
      items = dataEl ? JSON.parse((dataEl.textContent || '').trim() || '[]') : [];
    } catch (e) {
      console.error('STL JSON parse error', e);
      items = [];
    }

    const titleEl = root.querySelector('[data-stl-title]');
    const priceEl = root.querySelector('[data-stl-price]');
    const ratingEl = root.querySelector('[data-stl-rating]');
    const colorsEl = root.querySelector('[data-stl-colors]');
    const sizesEl = root.querySelector('[data-stl-sizes]');
    const detailsEl = root.querySelector('[data-stl-details]');

    const hotspots = Array.from(root.querySelectorAll('[data-stl-hotspot]'));
    const addBtn = root.querySelector('[data-stl-add]');
    const addText = root.querySelector('[data-stl-add-text]');
    const cartEl = root.querySelector('[data-stl-cart]');

    let cartCount = 0;

    const render = (idx) => {
      const item = items[idx] || items[0];
      if (!item) return;

      hotspots.forEach((b) => b.classList.toggle('is-active', Number(b.dataset.stlIndex) === idx));

      if (titleEl) titleEl.textContent = item.title || 'Product name';
      if (priceEl) priceEl.textContent = item.price || '$55';
      if (ratingEl) ratingEl.textContent = item.ratingText || '';
      if (detailsEl) detailsEl.innerHTML = item.detailsHtml || '';

      const colors = (item.colors || '').split(',').map(s => s.trim()).filter(Boolean);
      const sizes = (item.sizes || '').split(',').map(s => s.trim()).filter(Boolean);

      if (colorsEl){
        colorsEl.innerHTML = '';
        (colors.length ? colors : ['#ffffff','#2c2c2c','#7f7f7f','#c4bdb6']).forEach((c, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'fetchly-stl__swatch' + (i === 0 ? ' is-active' : '');
          btn.style.background = c;
          btn.setAttribute('aria-label', 'Color ' + (i + 1));
          btn.addEventListener('click', () => {
            Array.from(colorsEl.children).forEach((x, xi) => x.classList.toggle('is-active', xi === i));
          });
          colorsEl.appendChild(btn);
        });
      }

      if (sizesEl){
        sizesEl.innerHTML = '';
        (sizes.length ? sizes : ['S','M','L','XL']).forEach((s, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'fetchly-stl__size' + (i === 0 ? ' is-active' : '');
          btn.textContent = s;
          btn.addEventListener('click', () => {
            Array.from(sizesEl.children).forEach((x, xi) => x.classList.toggle('is-active', xi === i));
          });
          sizesEl.appendChild(btn);
        });
      }

      if (addText) addText.textContent = 'Add To Cart';
      if (addBtn) addBtn.disabled = false;
    };

    hotspots.forEach((btn) => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const idx = Number(btn.dataset.stlIndex || 0);
        render(idx);
      });
    });

    if (addBtn){
      addBtn.addEventListener('click', (e) => {
        e.preventDefault();
        cartCount += 1;
        if (cartEl) cartEl.textContent = String(cartCount);
        if (addText) addText.textContent = 'Added ✓';
        addBtn.disabled = true;
        window.setTimeout(() => {
          if (addText) addText.textContent = 'Add To Cart';
          addBtn.disabled = false;
        }, 900);
      });
    }

    render(0);
  };

  const initAll = () => {
    document.querySelectorAll('.fetchly-stl').forEach(initSTL);
  };

  initAll();

  document.addEventListener('shopify:section:load', (event) => {
    const sectionRoot = event.target;
    if (!sectionRoot) return;
    sectionRoot.querySelectorAll('.fetchly-stl').forEach((el) => {
      el.dataset.stlInit = '0';
      initSTL(el);
    });
  });
})();
</script>


{% schema %}
{
  "name": "Shop the look (Mock)",
  "settings": [
    { "type": "image_picker", "id": "image", "label": "Main image" },
    { "type": "color", "id": "bg", "label": "Background", "default": "#6b2b22" },
    { "type": "color", "id": "fg", "label": "Text color", "default": "#f6f0ea" },
    { "type": "richtext", "id": "size_chart_text", "label": "Size charts text", "default": "<p>Size chart info goes here.</p>" },
    { "type": "richtext", "id": "model_info_text", "label": "Model information text", "default": "<p>Model info goes here.</p>" },
    { "type": "text", "id": "subtext", "label": "Subtext", "default": "Free shipping over $50" }
  ],
  "blocks": [
    {
      "type": "hotspot",
      "name": "Hotspot",
      "settings": [
        { "type": "range", "id": "x", "label": "X position (%)", "min": 0, "max": 100, "step": 1, "default": 20 },
        { "type": "range", "id": "y", "label": "Y position (%)", "min": 0, "max": 100, "step": 1, "default": 55 },

        { "type": "text", "id": "title", "label": "Product name", "default": "Product name" },
        { "type": "text", "id": "price", "label": "Price", "default": "$55" },
        { "type": "text", "id": "rating_text", "label": "Rating text", "default": "★★★★★ (3.5 stars) • 10 reviews" },

        { "type": "text", "id": "colors", "label": "Colors (comma list, hex)", "default": "#ffffff, #2c2c2c, #7f7f7f, #c4bdb6" },
        { "type": "text", "id": "sizes", "label": "Sizes (comma list)", "default": "S, M, L, XL" },

        { "type": "richtext", "id": "details", "label": "Details", "default": "<p>Discover our new clothing line, blending comfort and style.</p><p>Explore this versatile clothing collection for your projects.</p>" }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop the look (Mock)",
      "blocks": [
        { "type": "hotspot" },
        { "type": "hotspot" },
        { "type": "hotspot" }
      ]
    }
  ]
}
{% endschema %}
